[gd_scene load_steps=27 format=4 uid="uid://bf6l6gw486uwb"]

[ext_resource type="TileSet" uid="uid://cv5hbh50gwf0m" path="res://assets/LevelTiles.tres" id="1_m33p3"]
[ext_resource type="Script" uid="uid://dnto4wx4tlg12" path="res://scenes/debugger.gd" id="1_oo54l"]
[ext_resource type="FontFile" uid="uid://yej5vxj50iqs" path="res://assets/font/m5x7.ttf" id="2_kpybi"]
[ext_resource type="PackedScene" uid="uid://clcphumb7x1fi" path="res://actors/monster_container.tscn" id="3_k0juu"]
[ext_resource type="PackedScene" uid="uid://jrijq5330mc3" path="res://actors/monster.tscn" id="4_71j4m"]
[ext_resource type="PackedScene" uid="uid://e4vn3snwj3bp" path="res://scenes/interactables/obstacles/door.tscn" id="4_kpybi"]
[ext_resource type="PackedScene" uid="uid://b7ffejioelqqr" path="res://actors/player.tscn" id="5_71j4m"]
[ext_resource type="PackedScene" uid="uid://dxeyq3nkf0btw" path="res://scenes/interactables/lootables/chest.tscn" id="6_ctatt"]
[ext_resource type="AudioStream" uid="uid://b2e1b1lgnyh7f" path="res://assets/audio/ambiance/cave_ambiance.wav" id="8_7r4gi"]
[ext_resource type="Texture2D" uid="uid://b5syd7ugowpqv" path="res://assets/sprites/interactables/level-entrance.png" id="9_ctatt"]
[ext_resource type="Script" uid="uid://cab8cyrahr2b5" path="res://scenes/background_music.gd" id="9_w7kh3"]
[ext_resource type="PackedScene" uid="uid://djqad3fs433mu" path="res://scenes/ui/space_selector.tscn" id="10_ctatt"]
[ext_resource type="PackedScene" uid="uid://607tiukkn1lq" path="res://scenes/hud.tscn" id="10_oo54l"]
[ext_resource type="Script" uid="uid://bj030xcndthp7" path="res://scenes/carousel_container.gd" id="10_pm21f"]
[ext_resource type="Texture2D" uid="uid://ixufa54odgdh" path="res://assets/sprites/interactables/level-exit.png" id="10_xgqkh"]
[ext_resource type="Script" uid="uid://b5qe5ftfbq8er" path="res://resources/actions/action_base.gd" id="12_pm21f"]
[ext_resource type="Resource" uid="uid://qew7y3uofvmo" path="res://resources/actions/interactions/variants/open.tres" id="15_kpybi"]
[ext_resource type="Resource" uid="uid://txkgx07hsqdh" path="res://resources/actions/combat_actions/variants/fireball.tres" id="15_oo54l"]
[ext_resource type="Resource" uid="uid://oljlvpajfin3" path="res://resources/actions/interactions/variants/use.tres" id="16_oo54l"]
[ext_resource type="Resource" uid="uid://bm2o1qk2xtofu" path="res://resources/actions/combat_actions/variants/heal.tres" id="16_xgqkh"]
[ext_resource type="PackedScene" uid="uid://8uqlohigjsfq" path="res://scenes/card_carousel.tscn" id="17_7t5mc"]
[ext_resource type="Resource" uid="uid://dp0nig7y4nlb1" path="res://resources/actions/combat_actions/variants/melee_attack.tres" id="17_munwf"]
[ext_resource type="Resource" uid="uid://bcp3j6fht5j2j" path="res://resources/actions/combat_actions/variants/wait.tres" id="18_ts3gi"]
[ext_resource type="Resource" uid="uid://crswbcrki1gf4" path="res://resources/actions/items/variants/crown.tres" id="19_0nbtd"]
[ext_resource type="PackedScene" uid="uid://csfjhmmnapy2u" path="res://scenes/interactables/breakables/barrel.tscn" id="21_7iits"]

[sub_resource type="Theme" id="Theme_ctatt"]
default_font = ExtResource("2_kpybi")
default_font_size = 12

[node name="GameContainer" type="Node2D"]

[node name="DebugHUD" type="CanvasLayer" parent="."]

[node name="Debugger" type="Control" parent="DebugHUD"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme = SubResource("Theme_ctatt")
script = ExtResource("1_oo54l")

[node name="VBoxContainer" type="VBoxContainer" parent="DebugHUD/Debugger"]
layout_mode = 1
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -40.0
offset_bottom = 40.0
grow_horizontal = 0
theme_override_constants/separation = 0

[node name="Label" type="Label" parent="DebugHUD/Debugger/VBoxContainer"]
layout_mode = 2
theme_override_fonts/font = ExtResource("2_kpybi")
theme_override_font_sizes/font_size = 12

[node name="TextureRect" type="TextureRect" parent="DebugHUD/Debugger/VBoxContainer"]
layout_mode = 2
size_flags_horizontal = 8
size_flags_vertical = 4

[node name="World" type="Node2D" parent="."]
position = Vector2(200, 72)

[node name="Tiles" type="Node2D" parent="World"]
position = Vector2(0, -1)
scale = Vector2(0.5, 0.5)

[node name="Colliders" type="TileMapLayer" parent="World/Tiles"]
position = Vector2(0, 2)
tile_map_data = PackedByteArray("AAD+//7/AwAAAAAAAAD+////AwAAAAAAAAD0/wAAAwAAAAAAAAD0//z/AwAAAAAAAAD0//3/AwAAAAAAAAD0//7/AwAAAAAAAAD0////AwAAAAAAAAD9//7/AwABAAAAAAD0/wEAAwABAAAAAAD1/wEAAwABAAAAAAD2/wEAAwABAAAAAAD3/wEAAwABAAAAAAD4/wEAAwAAAAAAAAD6/wEAAwAAAAAAAAD7/wEAAwABAAAAAAD8/wEAAwABAAAAAAD9/wEAAwABAAAAAAD+/wEAAwABAAAAAAD+/wAAAwAAAAAAAAD7//7/AwABAAAAAAD7//3/AwAAAAAAAAD0//v/AwAAAAAAAAD1//v/AwABAAAAAAD2//v/AwABAAAAAAD3//v/AwAAAAAAAAD3//z/AwAAAAAAAAD2//7/AwAAAAAAAAD2//3/AwAAAAAAAAD2////AwABAAAAAAD4//z/AwABAAAAAAD5//z/AwABAAAAAAD6//z/AwABAAAAAAD7//z/AwAAAAAAAAD3//3/AwABAAAAAAD5//v/AwAAAAAAAAD5//r/AwAAAAAAAAD5//n/AwAAAAAAAAD9//3/AwAAAAAAAAD9//z/AwAAAAAAAAD9//v/AwAAAAAAAAD9//r/AwAAAAAAAAD6//n/AwABAAAAAAD7//n/AwABAAAAAAD8//n/AwABAAAAAAD9//n/AwAAAAAAAAD3/wYAAwAAAAAAAAD3/wcAAwAAAAAAAAD3/wgAAwABAAAAAAD4/wYAAwABAAAAAAD4/wgAAwABAAAAAAD5/wgAAwABAAAAAAD6/wYAAwAAAAAAAAD6/wcAAwAAAAAAAAD6/wgAAwABAAAAAAD4/wUAAwAAAAAAAAD4/wQAAwAAAAAAAAD4/wMAAwAAAAAAAAD4/wIAAwAAAAAAAAD6/wUAAwAAAAAAAAD6/wQAAwAAAAAAAAD7/wQAAwABAAAAAAD7/wMAAwAAAAAAAAD7/wIAAwAAAAAAAAD6/wIAAwABAAAAAAD5/wEAAwABAAAAAAA=")
tile_set = ExtResource("1_m33p3")

[node name="Monsters" parent="World" instance=ExtResource("3_k0juu")]
visible = false
position = Vector2(-24, 15)
scale = Vector2(1, 1)

[node name="Lich" parent="World/Monsters" instance=ExtResource("4_71j4m")]
position = Vector2(-288, -263)

[node name="Skeleton" parent="World/Monsters" instance=ExtResource("4_71j4m")]
position = Vector2(32, -55)
region_rect = Rect2(0, 128, 32, 32)
max_movement_repeat = 3

[node name="Interactables" type="Node2D" parent="World"]

[node name="Barrel2" parent="World/Interactables" instance=ExtResource("21_7iits")]
position = Vector2(-40, -8)

[node name="Barrel3" parent="World/Interactables" instance=ExtResource("21_7iits")]
position = Vector2(-88, -72)

[node name="Door" parent="World/Interactables" instance=ExtResource("4_kpybi")]
position = Vector2(-168, -8)

[node name="Door3" parent="World/Interactables" instance=ExtResource("4_kpybi")]
position = Vector2(-56, -24)

[node name="Door2" parent="World/Interactables" instance=ExtResource("4_kpybi")]
position = Vector2(-104, 24)

[node name="Chest" parent="World/Interactables" instance=ExtResource("6_ctatt")]
position = Vector2(-104, -40)

[node name="Chest2" parent="World/Interactables" instance=ExtResource("6_ctatt")]
position = Vector2(-88, -88)

[node name="Entrance" type="Sprite2D" parent="World"]
position = Vector2(-120, 120)
scale = Vector2(0.5, 0.5)
texture = ExtResource("9_ctatt")

[node name="Marker2D" type="Marker2D" parent="World/Entrance"]
position = Vector2(32, 0)

[node name="Exit" type="Sprite2D" parent="World"]
position = Vector2(-152, -56)
scale = Vector2(0.5, 0.5)
texture = ExtResource("10_xgqkh")

[node name="Marker2D" type="Marker2D" parent="World/Exit"]
position = Vector2(-32, 0)

[node name="Player" parent="." instance=ExtResource("5_71j4m")]
position = Vector2(96, 128)

[node name="SpaceSelector" parent="." node_paths=PackedStringArray("player") instance=ExtResource("10_ctatt")]
player = NodePath("../Player")

[node name="CarouselContainer" type="CanvasLayer" parent="."]
script = ExtResource("10_pm21f")

[node name="InteractionCarousel" parent="CarouselContainer" instance=ExtResource("17_7t5mc")]
position = Vector2(-68, 0)
card_actions = Array[ExtResource("12_pm21f")]([ExtResource("16_oo54l"), ExtResource("15_kpybi")])

[node name="CombatCarousel" parent="CarouselContainer" instance=ExtResource("17_7t5mc")]
position = Vector2(-68, 0)
card_actions = Array[ExtResource("12_pm21f")]([ExtResource("17_munwf"), ExtResource("16_xgqkh"), ExtResource("18_ts3gi"), ExtResource("15_oo54l")])

[node name="InventoryCarousel" parent="CarouselContainer" instance=ExtResource("17_7t5mc")]
position = Vector2(-68, 0)
card_actions = Array[ExtResource("12_pm21f")]([ExtResource("19_0nbtd")])

[node name="HUD" parent="." instance=ExtResource("10_oo54l")]
visible = false

[node name="BackgroundMusic" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource("8_7r4gi")
script = ExtResource("9_w7kh3")

[connection signal="monster_turn_over" from="World/Monsters" to="Player" method="unlock_movement"]
[connection signal="players_turn_over" from="Player" to="World/Monsters" method="handle_monster_movement"]
[connection signal="finished" from="BackgroundMusic" to="BackgroundMusic" method="loop_audio"]
